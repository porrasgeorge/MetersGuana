addDataFrame(t1, sheet, col.names=TRUE, row.names=TRUE,
startRow=1, startColumn=1, colnamesStyle=cs3,
rownamesStyle=cs1, showNA=FALSE, characterNA="", byrow=FALSE)
cb <-  CellBlock(sheet, startRow = 1, startColumn = 1, noRows = 10, noColumns = 10)
CB.setBorder(cellBlock = cb, border = cs4, 1:10, 1:10)
data_gather <- data[,c(1,2,12:20)]
data_gather <- data_gather %>% gather("Variable", "Value", -c("Quantity", "cantidad"))
ggplot(data_gather, aes(x = Variable, y = Value, fill = Quantity, label = Value)) +
geom_col(position = "dodge", width = 0.7) +
scale_y_continuous(labels = function(x) paste0(x, "%"), limits = c(0, 120)) +
geom_text(aes(label=sprintf("%0.2f%%", Value)),
position = position_dodge(0.9),
angle = 90, size = 2) +
theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 8)) +
ggtitle(meter) +
xlab("Medicion") +
ylab("Porcentaje")
ggsave(paste0(meter,".png"), width = 7, height = 4, units = "in")
addPicture(paste0(meter,".png"), sheet, scale = 1, startRow = 12, startColumn = 1)
}
saveWorkbook(wb, "CoopeGuanacaste.xlsx")
# Libro de excel
wb<-createWorkbook(type="xlsx")
cs1 <- CellStyle(wb) + Font(wb, isItalic=TRUE)           # rowcolumns
cs2 <- CellStyle(wb) + Font(wb, color="blue")
cs3 <- CellStyle(wb) + Font(wb, isBold=TRUE) + Border()  # header
cs4 <- Border(color="red", position=c("TOP", "BOTTOM"), pen=c("BORDER_THIN", "BORDER_THICK"))
# Recorrer cada medidor
for(meter in sources$Name){
sheet <-createSheet(wb, sheetName = meter)
data <- datalog_byMonth %>% filter(Meter == meter)
data <- as.data.frame(data[,c(4:14)])
## se agregan columnas con porcentuales
data$TN087p <- round(100 * data$TN087/data$cantidad, 2)
data$TN087_091p <- round(100 * data$TN087_091/data$cantidad, 2)
data$TN091_093p <- round(100 * data$TN091_093/data$cantidad, 2)
data$TN093_095p <- round(100 * data$TN093_095/data$cantidad, 2)
data$TN095_105p <- round(100 * data$TN095_105/data$cantidad, 2)
data$TN105_107p <- round(100 * data$TN105_107/data$cantidad, 2)
data$TN107_109p <- round(100 * data$TN107_109/data$cantidad, 2)
data$TN109_113p <- round(100 * data$TN109_113/data$cantidad, 2)
data$TN113p <- round(100 * data$TN113/data$cantidad, 2)
tabla_resumen <- as.data.frame(t(data), stringsAsFactors = F)
colnames(tabla_resumen) <- as.character(unlist(tabla_resumen[1,]))
tabla_resumen <- tabla_resumen[3:nrow(tabla_resumen),]
t1 <- tabla_resumen[1:9,]
t1[,4:6] <- tabla_resumen[10:18,]
colnames(t1) <- c("Vab","Vbc","Vca", "Vab_%","Vbc_%","Vca_%")
t1$low_limit <- c(0, limit087, limit091, limit093, limit095, limit105, limit107, limit109, limit113)
t1$high_limit <- c(limit087, limit091, limit093, limit095, limit105, limit107, limit109, limit113, 100000)
t1 <- t1[,c(7, 8, 1, 4, 2 , 5, 3, 6)]
rm(tabla_resumen)
setColumnWidth(sheet, colIndex=1, colWidth=20)
setColumnWidth(sheet, colIndex=2:ncol(t1), colWidth=15)
cb <-  CellBlock(sheet, startRow = 1, startColumn = 1, noRows = 10, noColumns = 10)
CB.setBorder(cellBlock = cb, border = cs4, 1:10, 1:10)
addDataFrame(t1, sheet, col.names=TRUE, row.names=TRUE,
startRow=1, startColumn=1, colnamesStyle=cs3, CellStyle = cs4,
rownamesStyle=cs1, showNA=FALSE, characterNA="", byrow=FALSE)
data_gather <- data[,c(1,2,12:20)]
data_gather <- data_gather %>% gather("Variable", "Value", -c("Quantity", "cantidad"))
ggplot(data_gather, aes(x = Variable, y = Value, fill = Quantity, label = Value)) +
geom_col(position = "dodge", width = 0.7) +
scale_y_continuous(labels = function(x) paste0(x, "%"), limits = c(0, 120)) +
geom_text(aes(label=sprintf("%0.2f%%", Value)),
position = position_dodge(0.9),
angle = 90, size = 2) +
theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 8)) +
ggtitle(meter) +
xlab("Medicion") +
ylab("Porcentaje")
ggsave(paste0(meter,".png"), width = 7, height = 4, units = "in")
addPicture(paste0(meter,".png"), sheet, scale = 1, startRow = 12, startColumn = 1)
}
# Libro de excel
wb<-createWorkbook(type="xlsx")
cs1 <- CellStyle(wb) + Font(wb, isItalic=TRUE)           # rowcolumns
cs2 <- CellStyle(wb) + Font(wb, color="blue")
cs3 <- CellStyle(wb) + Font(wb, isBold=TRUE) + Border()  # header
cs4 <- Border(color="red", position=c("TOP", "BOTTOM"), pen=c("BORDER_THIN", "BORDER_THICK"))
# Recorrer cada medidor
for(meter in sources$Name){
sheet <-createSheet(wb, sheetName = meter)
data <- datalog_byMonth %>% filter(Meter == meter)
data <- as.data.frame(data[,c(4:14)])
## se agregan columnas con porcentuales
data$TN087p <- round(100 * data$TN087/data$cantidad, 2)
data$TN087_091p <- round(100 * data$TN087_091/data$cantidad, 2)
data$TN091_093p <- round(100 * data$TN091_093/data$cantidad, 2)
data$TN093_095p <- round(100 * data$TN093_095/data$cantidad, 2)
data$TN095_105p <- round(100 * data$TN095_105/data$cantidad, 2)
data$TN105_107p <- round(100 * data$TN105_107/data$cantidad, 2)
data$TN107_109p <- round(100 * data$TN107_109/data$cantidad, 2)
data$TN109_113p <- round(100 * data$TN109_113/data$cantidad, 2)
data$TN113p <- round(100 * data$TN113/data$cantidad, 2)
tabla_resumen <- as.data.frame(t(data), stringsAsFactors = F)
colnames(tabla_resumen) <- as.character(unlist(tabla_resumen[1,]))
tabla_resumen <- tabla_resumen[3:nrow(tabla_resumen),]
t1 <- tabla_resumen[1:9,]
t1[,4:6] <- tabla_resumen[10:18,]
colnames(t1) <- c("Vab","Vbc","Vca", "Vab_%","Vbc_%","Vca_%")
t1$low_limit <- c(0, limit087, limit091, limit093, limit095, limit105, limit107, limit109, limit113)
t1$high_limit <- c(limit087, limit091, limit093, limit095, limit105, limit107, limit109, limit113, 100000)
t1 <- t1[,c(7, 8, 1, 4, 2 , 5, 3, 6)]
rm(tabla_resumen)
setColumnWidth(sheet, colIndex=1, colWidth=20)
setColumnWidth(sheet, colIndex=2:ncol(t1), colWidth=15)
cb <-  CellBlock(sheet, startRow = 1, startColumn = 1, noRows = 10, noColumns = 10)
CB.setBorder(cellBlock = cb, border = cs4, 1:10, 1:10)
addDataFrame(t1, sheet, col.names=TRUE, row.names=TRUE,
startRow=1, startColumn=1, colnamesStyle=cs3,
rownamesStyle=cs1, showNA=FALSE, characterNA="", byrow=FALSE)
data_gather <- data[,c(1,2,12:20)]
data_gather <- data_gather %>% gather("Variable", "Value", -c("Quantity", "cantidad"))
ggplot(data_gather, aes(x = Variable, y = Value, fill = Quantity, label = Value)) +
geom_col(position = "dodge", width = 0.7) +
scale_y_continuous(labels = function(x) paste0(x, "%"), limits = c(0, 120)) +
geom_text(aes(label=sprintf("%0.2f%%", Value)),
position = position_dodge(0.9),
angle = 90, size = 2) +
theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 8)) +
ggtitle(meter) +
xlab("Medicion") +
ylab("Porcentaje")
ggsave(paste0(meter,".png"), width = 7, height = 4, units = "in")
addPicture(paste0(meter,".png"), sheet, scale = 1, startRow = 12, startColumn = 1)
}
saveWorkbook(wb, "CoopeGuanacaste.xlsx")
# Libro de excel
wb<-createWorkbook(type="xlsx")
cs1 <- CellStyle(wb) + Font(wb, isItalic=TRUE)           # rowcolumns
cs2 <- CellStyle(wb) + Font(wb, color="blue")
cs3 <- CellStyle(wb) + Font(wb, isBold=TRUE) + Border()  # header
cs4 <- Border(color="red", position=c("TOP", "BOTTOM"), pen=c("BORDER_THIN", "BORDER_THICK"))
# Recorrer cada medidor
for(meter in sources$Name){
sheet <-createSheet(wb, sheetName = meter)
data <- datalog_byMonth %>% filter(Meter == meter)
data <- as.data.frame(data[,c(4:14)])
## se agregan columnas con porcentuales
data$TN087p <- round(100 * data$TN087/data$cantidad, 2)
data$TN087_091p <- round(100 * data$TN087_091/data$cantidad, 2)
data$TN091_093p <- round(100 * data$TN091_093/data$cantidad, 2)
data$TN093_095p <- round(100 * data$TN093_095/data$cantidad, 2)
data$TN095_105p <- round(100 * data$TN095_105/data$cantidad, 2)
data$TN105_107p <- round(100 * data$TN105_107/data$cantidad, 2)
data$TN107_109p <- round(100 * data$TN107_109/data$cantidad, 2)
data$TN109_113p <- round(100 * data$TN109_113/data$cantidad, 2)
data$TN113p <- round(100 * data$TN113/data$cantidad, 2)
tabla_resumen <- as.data.frame(t(data), stringsAsFactors = F)
colnames(tabla_resumen) <- as.character(unlist(tabla_resumen[1,]))
tabla_resumen <- tabla_resumen[3:nrow(tabla_resumen),]
t1 <- tabla_resumen[1:9,]
t1[,4:6] <- tabla_resumen[10:18,]
colnames(t1) <- c("Vab","Vbc","Vca", "Vab_%","Vbc_%","Vca_%")
t1$low_limit <- c(0, limit087, limit091, limit093, limit095, limit105, limit107, limit109, limit113)
t1$high_limit <- c(limit087, limit091, limit093, limit095, limit105, limit107, limit109, limit113, 100000)
t1 <- t1[,c(7, 8, 1, 4, 2 , 5, 3, 6)]
rm(tabla_resumen)
setColumnWidth(sheet, colIndex=1, colWidth=20)
setColumnWidth(sheet, colIndex=2:ncol(t1), colWidth=15)
cb <-  CellBlock(sheet, startRow = 1, startColumn = 1, noRows = 10, noColumns = 10)
CB.setBorder(cellBlock = cb, border = cs4, 1:10, 1:10)
addDataFrame(t1, sheet, col.names=TRUE, row.names=TRUE,
startRow=1, startColumn=1, colnamesStyle=cs3,
rownamesStyle=cs1, showNA=FALSE, characterNA="", byrow=FALSE)
data_gather <- data[,c(1,2,12:20)]
data_gather <- data_gather %>% gather("Variable", "Value", -c("Quantity", "cantidad"))
ggplot(data_gather, aes(x = Variable, y = Value, fill = Quantity, label = Value)) +
geom_col(position = "dodge", width = 0.7) +
scale_y_continuous(labels = function(x) paste0(x, "%"), limits = c(0, 120)) +
geom_text(aes(label=sprintf("%0.2f%%", Value)),
position = position_dodge(0.9),
angle = 90, size = 2) +
theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 8)) +
ggtitle(meter) +
xlab("Medicion") +
ylab("Porcentaje")
ggsave(paste0(meter,".png"), width = 7, height = 4, units = "in")
addPicture(paste0(meter,".png"), sheet, scale = 1, startRow = 12, startColumn = 1)
}
saveWorkbook(wb, "CoopeGuanacaste.xlsx")
# Libro de excel
wb<-createWorkbook(type="xlsx")
cs1 <- CellStyle(wb) + Font(wb, isItalic=TRUE)           # rowcolumns
cs2 <- CellStyle(wb) + Font(wb, color="blue")
cs3 <- CellStyle(wb) + Font(wb, isBold=TRUE) + Border()  # header
cs4 <- Border(color="red", position=c("TOP", "BOTTOM"), pen=c("BORDER_THIN", "BORDER_THICK"))
# Recorrer cada medidor
for(meter in sources$Name){
sheet <-createSheet(wb, sheetName = meter)
data <- datalog_byMonth %>% filter(Meter == meter)
data <- as.data.frame(data[,c(4:14)])
## se agregan columnas con porcentuales
data$TN087p <- round(100 * data$TN087/data$cantidad, 2)
data$TN087_091p <- round(100 * data$TN087_091/data$cantidad, 2)
data$TN091_093p <- round(100 * data$TN091_093/data$cantidad, 2)
data$TN093_095p <- round(100 * data$TN093_095/data$cantidad, 2)
data$TN095_105p <- round(100 * data$TN095_105/data$cantidad, 2)
data$TN105_107p <- round(100 * data$TN105_107/data$cantidad, 2)
data$TN107_109p <- round(100 * data$TN107_109/data$cantidad, 2)
data$TN109_113p <- round(100 * data$TN109_113/data$cantidad, 2)
data$TN113p <- round(100 * data$TN113/data$cantidad, 2)
tabla_resumen <- as.data.frame(t(data), stringsAsFactors = F)
colnames(tabla_resumen) <- as.character(unlist(tabla_resumen[1,]))
tabla_resumen <- tabla_resumen[3:nrow(tabla_resumen),]
t1 <- tabla_resumen[1:9,]
t1[,4:6] <- tabla_resumen[10:18,]
colnames(t1) <- c("Vab","Vbc","Vca", "Vab_%","Vbc_%","Vca_%")
t1$low_limit <- c(0, limit087, limit091, limit093, limit095, limit105, limit107, limit109, limit113)
t1$high_limit <- c(limit087, limit091, limit093, limit095, limit105, limit107, limit109, limit113, 100000)
t1 <- t1[,c(7, 8, 1, 4, 2 , 5, 3, 6)]
rm(tabla_resumen)
setColumnWidth(sheet, colIndex=1, colWidth=20)
setColumnWidth(sheet, colIndex=2:ncol(t1), colWidth=15)
addDataFrame(t1, sheet, col.names=TRUE, row.names=TRUE,
startRow=1, startColumn=1, colnamesStyle=cs3,
rownamesStyle=cs1, showNA=FALSE, characterNA="", byrow=FALSE)
cb <-  CellBlock(sheet, startRow = 1, startColumn = 1, noRows = 10, noColumns = 10, create = F)
CB.setBorder(cellBlock = cb, border = cs4, 1:10, 1:10)
data_gather <- data[,c(1,2,12:20)]
data_gather <- data_gather %>% gather("Variable", "Value", -c("Quantity", "cantidad"))
ggplot(data_gather, aes(x = Variable, y = Value, fill = Quantity, label = Value)) +
geom_col(position = "dodge", width = 0.7) +
scale_y_continuous(labels = function(x) paste0(x, "%"), limits = c(0, 120)) +
geom_text(aes(label=sprintf("%0.2f%%", Value)),
position = position_dodge(0.9),
angle = 90, size = 2) +
theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 8)) +
ggtitle(meter) +
xlab("Medicion") +
ylab("Porcentaje")
ggsave(paste0(meter,".png"), width = 7, height = 4, units = "in")
addPicture(paste0(meter,".png"), sheet, scale = 1, startRow = 12, startColumn = 1)
}
saveWorkbook(wb, "CoopeGuanacaste.xlsx")
# Libro de excel
wb<-createWorkbook(type="xlsx")
cs1 <- CellStyle(wb) + Font(wb, isItalic=TRUE)           # rowcolumns
cs2 <- CellStyle(wb) + Font(wb, color="blue")
cs3 <- CellStyle(wb) + Font(wb, isBold=TRUE) + Border()  # header
cs4 <- Border(color="red", position=c("TOP", "BOTTOM"), pen=c("BORDER_THIN", "BORDER_THICK"))
# Recorrer cada medidor
for(meter in sources$Name){
sheet <-createSheet(wb, sheetName = meter)
data <- datalog_byMonth %>% filter(Meter == meter)
data <- as.data.frame(data[,c(4:14)])
## se agregan columnas con porcentuales
data$TN087p <- round(100 * data$TN087/data$cantidad, 2)
data$TN087_091p <- round(100 * data$TN087_091/data$cantidad, 2)
data$TN091_093p <- round(100 * data$TN091_093/data$cantidad, 2)
data$TN093_095p <- round(100 * data$TN093_095/data$cantidad, 2)
data$TN095_105p <- round(100 * data$TN095_105/data$cantidad, 2)
data$TN105_107p <- round(100 * data$TN105_107/data$cantidad, 2)
data$TN107_109p <- round(100 * data$TN107_109/data$cantidad, 2)
data$TN109_113p <- round(100 * data$TN109_113/data$cantidad, 2)
data$TN113p <- round(100 * data$TN113/data$cantidad, 2)
tabla_resumen <- as.data.frame(t(data), stringsAsFactors = F)
colnames(tabla_resumen) <- as.character(unlist(tabla_resumen[1,]))
tabla_resumen <- tabla_resumen[3:nrow(tabla_resumen),]
t1 <- tabla_resumen[1:9,]
t1[,4:6] <- tabla_resumen[10:18,]
colnames(t1) <- c("Vab","Vbc","Vca", "Vab_%","Vbc_%","Vca_%")
t1$low_limit <- c(0, limit087, limit091, limit093, limit095, limit105, limit107, limit109, limit113)
t1$high_limit <- c(limit087, limit091, limit093, limit095, limit105, limit107, limit109, limit113, 100000)
t1 <- t1[,c(7, 8, 1, 4, 2 , 5, 3, 6)]
rm(tabla_resumen)
setColumnWidth(sheet, colIndex=1, colWidth=20)
setColumnWidth(sheet, colIndex=2:ncol(t1), colWidth=15)
addDataFrame(t1, sheet, col.names=TRUE, row.names=TRUE,
startRow=1, startColumn=1, colnamesStyle=cs3,
rownamesStyle=cs1, showNA=FALSE, characterNA="", byrow=FALSE)
cb <-  CellBlock(sheet, startRow = 1, startColumn = 1, noRows = 10, noColumns = 10, create = F)
CB.setBorder(cellBlock = cb, border = cs4, 1:10, 1)
data_gather <- data[,c(1,2,12:20)]
data_gather <- data_gather %>% gather("Variable", "Value", -c("Quantity", "cantidad"))
ggplot(data_gather, aes(x = Variable, y = Value, fill = Quantity, label = Value)) +
geom_col(position = "dodge", width = 0.7) +
scale_y_continuous(labels = function(x) paste0(x, "%"), limits = c(0, 120)) +
geom_text(aes(label=sprintf("%0.2f%%", Value)),
position = position_dodge(0.9),
angle = 90, size = 2) +
theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 8)) +
ggtitle(meter) +
xlab("Medicion") +
ylab("Porcentaje")
ggsave(paste0(meter,".png"), width = 7, height = 4, units = "in")
addPicture(paste0(meter,".png"), sheet, scale = 1, startRow = 12, startColumn = 1)
}
saveWorkbook(wb, "CoopeGuanacaste.xlsx")
# Libro de excel
wb<-createWorkbook(type="xlsx")
cs1 <- CellStyle(wb) + Font(wb, isItalic=TRUE)           # rowcolumns
cs2 <- CellStyle(wb) + Font(wb, color="blue")
cs3 <- CellStyle(wb) + Font(wb, isBold=TRUE) + Border()  # header
cs4 <- Border(position=c("TOP", "BOTTOM", "LEFT", "RIGHT"), pen=c("BORDER_THIN"))
# Recorrer cada medidor
for(meter in sources$Name){
sheet <-createSheet(wb, sheetName = meter)
data <- datalog_byMonth %>% filter(Meter == meter)
data <- as.data.frame(data[,c(4:14)])
## se agregan columnas con porcentuales
data$TN087p <- round(100 * data$TN087/data$cantidad, 2)
data$TN087_091p <- round(100 * data$TN087_091/data$cantidad, 2)
data$TN091_093p <- round(100 * data$TN091_093/data$cantidad, 2)
data$TN093_095p <- round(100 * data$TN093_095/data$cantidad, 2)
data$TN095_105p <- round(100 * data$TN095_105/data$cantidad, 2)
data$TN105_107p <- round(100 * data$TN105_107/data$cantidad, 2)
data$TN107_109p <- round(100 * data$TN107_109/data$cantidad, 2)
data$TN109_113p <- round(100 * data$TN109_113/data$cantidad, 2)
data$TN113p <- round(100 * data$TN113/data$cantidad, 2)
tabla_resumen <- as.data.frame(t(data), stringsAsFactors = F)
colnames(tabla_resumen) <- as.character(unlist(tabla_resumen[1,]))
tabla_resumen <- tabla_resumen[3:nrow(tabla_resumen),]
t1 <- tabla_resumen[1:9,]
t1[,4:6] <- tabla_resumen[10:18,]
colnames(t1) <- c("Vab","Vbc","Vca", "Vab_%","Vbc_%","Vca_%")
t1$low_limit <- c(0, limit087, limit091, limit093, limit095, limit105, limit107, limit109, limit113)
t1$high_limit <- c(limit087, limit091, limit093, limit095, limit105, limit107, limit109, limit113, 100000)
t1 <- t1[,c(7, 8, 1, 4, 2 , 5, 3, 6)]
rm(tabla_resumen)
setColumnWidth(sheet, colIndex=1, colWidth=20)
setColumnWidth(sheet, colIndex=2:ncol(t1), colWidth=15)
addDataFrame(t1, sheet, col.names=TRUE, row.names=TRUE,
startRow=1, startColumn=1, colnamesStyle=cs3,
rownamesStyle=cs1, showNA=FALSE, characterNA="", byrow=FALSE)
cb <-  CellBlock(sheet, startRow = 1, startColumn = 1, noRows = 10, noColumns = 10, create = F)
CB.setBorder(cellBlock = cb, border = cs4, 1:10, 1)
data_gather <- data[,c(1,2,12:20)]
data_gather <- data_gather %>% gather("Variable", "Value", -c("Quantity", "cantidad"))
ggplot(data_gather, aes(x = Variable, y = Value, fill = Quantity, label = Value)) +
geom_col(position = "dodge", width = 0.7) +
scale_y_continuous(labels = function(x) paste0(x, "%"), limits = c(0, 120)) +
geom_text(aes(label=sprintf("%0.2f%%", Value)),
position = position_dodge(0.9),
angle = 90, size = 2) +
theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 8)) +
ggtitle(meter) +
xlab("Medicion") +
ylab("Porcentaje")
ggsave(paste0(meter,".png"), width = 7, height = 4, units = "in")
addPicture(paste0(meter,".png"), sheet, scale = 1, startRow = 12, startColumn = 1)
}
saveWorkbook(wb, "CoopeGuanacaste.xlsx")
# Libro de excel
wb<-createWorkbook(type="xlsx")
cs1 <- CellStyle(wb) + Font(wb, isItalic=TRUE)           # rowcolumns
cs2 <- CellStyle(wb) + Font(wb, color="blue")
cs3 <- CellStyle(wb) + Font(wb, isBold=TRUE) + Border()  # header
cs4 <- Border(position=c("TOP", "BOTTOM", "LEFT", "RIGHT"), pen=c("BORDER_THIN"))
# Recorrer cada medidor
for(meter in sources$Name){
sheet <-createSheet(wb, sheetName = meter)
data <- datalog_byMonth %>% filter(Meter == meter)
data <- as.data.frame(data[,c(4:14)])
## se agregan columnas con porcentuales
data$TN087p <- round(100 * data$TN087/data$cantidad, 2)
data$TN087_091p <- round(100 * data$TN087_091/data$cantidad, 2)
data$TN091_093p <- round(100 * data$TN091_093/data$cantidad, 2)
data$TN093_095p <- round(100 * data$TN093_095/data$cantidad, 2)
data$TN095_105p <- round(100 * data$TN095_105/data$cantidad, 2)
data$TN105_107p <- round(100 * data$TN105_107/data$cantidad, 2)
data$TN107_109p <- round(100 * data$TN107_109/data$cantidad, 2)
data$TN109_113p <- round(100 * data$TN109_113/data$cantidad, 2)
data$TN113p <- round(100 * data$TN113/data$cantidad, 2)
tabla_resumen <- as.data.frame(t(data), stringsAsFactors = F)
colnames(tabla_resumen) <- as.character(unlist(tabla_resumen[1,]))
tabla_resumen <- tabla_resumen[3:nrow(tabla_resumen),]
t1 <- tabla_resumen[1:9,]
t1[,4:6] <- tabla_resumen[10:18,]
colnames(t1) <- c("Vab","Vbc","Vca", "Vab_%","Vbc_%","Vca_%")
t1$low_limit <- c(0, limit087, limit091, limit093, limit095, limit105, limit107, limit109, limit113)
t1$high_limit <- c(limit087, limit091, limit093, limit095, limit105, limit107, limit109, limit113, 100000)
t1 <- t1[,c(7, 8, 1, 4, 2 , 5, 3, 6)]
rm(tabla_resumen)
setColumnWidth(sheet, colIndex=1, colWidth=20)
setColumnWidth(sheet, colIndex=2:ncol(t1), colWidth=15)
addDataFrame(t1, sheet, col.names=TRUE, row.names=TRUE,
startRow=1, startColumn=1, colnamesStyle=cs3,
rownamesStyle=cs1, showNA=FALSE, characterNA="", byrow=FALSE)
cb <-  CellBlock(sheet, startRow = 1, startColumn = 1, noRows = 10, noColumns = 10, create = F)
for (i in 1:9){
CB.setBorder(cellBlock = cb, border = cs4, 1:10, i)
}
data_gather <- data[,c(1,2,12:20)]
data_gather <- data_gather %>% gather("Variable", "Value", -c("Quantity", "cantidad"))
ggplot(data_gather, aes(x = Variable, y = Value, fill = Quantity, label = Value)) +
geom_col(position = "dodge", width = 0.7) +
scale_y_continuous(labels = function(x) paste0(x, "%"), limits = c(0, 120)) +
geom_text(aes(label=sprintf("%0.2f%%", Value)),
position = position_dodge(0.9),
angle = 90, size = 2) +
theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 8)) +
ggtitle(meter) +
xlab("Medicion") +
ylab("Porcentaje")
ggsave(paste0(meter,".png"), width = 7, height = 4, units = "in")
addPicture(paste0(meter,".png"), sheet, scale = 1, startRow = 12, startColumn = 1)
}
saveWorkbook(wb, "CoopeGuanacaste.xlsx")
# Libro de excel
wb<-createWorkbook(type="xlsx")
cs1 <- CellStyle(wb) + Font(wb, isItalic=TRUE)           # rowcolumns
cs2 <- CellStyle(wb) + Font(wb, color="blue")
cs3 <- CellStyle(wb) + Font(wb, isBold=TRUE) + Border()  # header
cs4 <- Border(position=c("TOP", "BOTTOM", "LEFT", "RIGHT"), pen=c("BORDER_THIN"))
# Recorrer cada medidor
for(meter in sources$Name){
sheet <-createSheet(wb, sheetName = meter)
data <- datalog_byMonth %>% filter(Meter == meter)
data <- as.data.frame(data[,c(4:14)])
## se agregan columnas con porcentuales
data$TN087p <- round(100 * data$TN087/data$cantidad, 2)
data$TN087_091p <- round(100 * data$TN087_091/data$cantidad, 2)
data$TN091_093p <- round(100 * data$TN091_093/data$cantidad, 2)
data$TN093_095p <- round(100 * data$TN093_095/data$cantidad, 2)
data$TN095_105p <- round(100 * data$TN095_105/data$cantidad, 2)
data$TN105_107p <- round(100 * data$TN105_107/data$cantidad, 2)
data$TN107_109p <- round(100 * data$TN107_109/data$cantidad, 2)
data$TN109_113p <- round(100 * data$TN109_113/data$cantidad, 2)
data$TN113p <- round(100 * data$TN113/data$cantidad, 2)
tabla_resumen <- as.data.frame(t(data), stringsAsFactors = F)
colnames(tabla_resumen) <- as.character(unlist(tabla_resumen[1,]))
tabla_resumen <- tabla_resumen[3:nrow(tabla_resumen),]
t1 <- tabla_resumen[1:9,]
t1[,4:6] <- tabla_resumen[10:18,]
colnames(t1) <- c("Vab","Vbc","Vca", "Vab_%","Vbc_%","Vca_%")
t1$low_limit <- c(0, limit087, limit091, limit093, limit095, limit105, limit107, limit109, limit113)
t1$high_limit <- c(limit087, limit091, limit093, limit095, limit105, limit107, limit109, limit113, 100000)
t1 <- t1[,c(7, 8, 1, 4, 2 , 5, 3, 6)]
rm(tabla_resumen)
setColumnWidth(sheet, colIndex=1, colWidth=20)
setColumnWidth(sheet, colIndex=2:ncol(t1), colWidth=15)
addDataFrame(t1, sheet, col.names=TRUE, row.names=TRUE,
startRow=1, startColumn=1, colnamesStyle=cs3,
rownamesStyle=cs1, showNA=FALSE, characterNA="", byrow=FALSE)
cb <-  CellBlock(sheet, startRow = 1, startColumn = 1, noRows = 10, noColumns = 10, create = F)
for (i in 1:9){
CB.setBorder(cellBlock = cb, border = cs4, 1:10, i)
}
data_gather <- data[,c(1,2,12:20)]
data_gather <- data_gather %>% gather("Variable", "Value", -c("Quantity", "cantidad"))
ggplot(data_gather, aes(x = Variable, y = Value, fill = Quantity, label = Value)) +
geom_col(position = "dodge", width = 0.7) +
scale_y_continuous(labels = function(x) paste0(x, "%"), limits = c(0, 120)) +
geom_text(aes(label=sprintf("%0.2f%%", Value)),
position = position_dodge(0.9),
angle = 90, size = 2) +
theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 8)) +
ggtitle(meter) +
xlab("Medicion") +
ylab("Porcentaje")
ggsave(paste0(meter,".png"), width = 7, height = 4, units = "in")
addPicture(paste0(meter,".png"), sheet, scale = 2, startRow = 12, startColumn = 1)
}
saveWorkbook(wb, "CoopeGuanacaste.xlsx")
# Libro de excel
wb<-createWorkbook(type="xlsx")
cs1 <- CellStyle(wb) + Font(wb, isItalic=TRUE)           # rowcolumns
cs2 <- CellStyle(wb) + Font(wb, color="blue")
cs3 <- CellStyle(wb) + Font(wb, isBold=TRUE) + Border()  # header
cs4 <- Border(position=c("TOP", "BOTTOM", "LEFT", "RIGHT"), pen=c("BORDER_THIN"))
# Recorrer cada medidor
for(meter in sources$Name){
sheet <-createSheet(wb, sheetName = meter)
data <- datalog_byMonth %>% filter(Meter == meter)
data <- as.data.frame(data[,c(4:14)])
## se agregan columnas con porcentuales
data$TN087p <- round(100 * data$TN087/data$cantidad, 2)
data$TN087_091p <- round(100 * data$TN087_091/data$cantidad, 2)
data$TN091_093p <- round(100 * data$TN091_093/data$cantidad, 2)
data$TN093_095p <- round(100 * data$TN093_095/data$cantidad, 2)
data$TN095_105p <- round(100 * data$TN095_105/data$cantidad, 2)
data$TN105_107p <- round(100 * data$TN105_107/data$cantidad, 2)
data$TN107_109p <- round(100 * data$TN107_109/data$cantidad, 2)
data$TN109_113p <- round(100 * data$TN109_113/data$cantidad, 2)
data$TN113p <- round(100 * data$TN113/data$cantidad, 2)
tabla_resumen <- as.data.frame(t(data), stringsAsFactors = F)
colnames(tabla_resumen) <- as.character(unlist(tabla_resumen[1,]))
tabla_resumen <- tabla_resumen[3:nrow(tabla_resumen),]
t1 <- tabla_resumen[1:9,]
t1[,4:6] <- tabla_resumen[10:18,]
colnames(t1) <- c("Vab","Vbc","Vca", "Vab_%","Vbc_%","Vca_%")
t1$low_limit <- c(0, limit087, limit091, limit093, limit095, limit105, limit107, limit109, limit113)
t1$high_limit <- c(limit087, limit091, limit093, limit095, limit105, limit107, limit109, limit113, 100000)
t1 <- t1[,c(7, 8, 1, 4, 2 , 5, 3, 6)]
rm(tabla_resumen)
setColumnWidth(sheet, colIndex=1, colWidth=20)
setColumnWidth(sheet, colIndex=2:ncol(t1), colWidth=15)
addDataFrame(t1, sheet, col.names=TRUE, row.names=TRUE,
startRow=1, startColumn=1, colnamesStyle=cs3,
rownamesStyle=cs1, showNA=FALSE, characterNA="", byrow=FALSE)
cb <-  CellBlock(sheet, startRow = 1, startColumn = 1, noRows = 10, noColumns = 10, create = F)
for (i in 1:9){
CB.setBorder(cellBlock = cb, border = cs4, 1:10, i)
}
data_gather <- data[,c(1,2,12:20)]
data_gather <- data_gather %>% gather("Variable", "Value", -c("Quantity", "cantidad"))
ggplot(data_gather, aes(x = Variable, y = Value, fill = Quantity, label = Value)) +
geom_col(position = "dodge", width = 0.7) +
scale_y_continuous(labels = function(x) paste0(x, "%"), limits = c(0, 120)) +
geom_text(aes(label=sprintf("%0.2f%%", Value)),
position = position_dodge(0.9),
angle = 90, size = 2) +
theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 8)) +
ggtitle(meter) +
xlab("Medicion") +
ylab("Porcentaje")
ggsave(paste0(meter,".png"), width = 7, height = 4, units = "in")
addPicture(paste0(meter,".png"), sheet, scale = 1.6, startRow = 12, startColumn = 1)
}
saveWorkbook(wb, "CoopeGuanacaste.xlsx")
