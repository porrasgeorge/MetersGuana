TN113 = mean(TN113))
datalog_byMonth_perc$TN087 <- percent(datalog_byMonth_perc$TN087 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN087_091 <- percent(datalog_byMonth_perc$TN087_091 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN091_093 <- percent(datalog_byMonth_perc$TN091_093 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN093_095 <- percent(datalog_byMonth_perc$TN093_095 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN095_105 <- percent(datalog_byMonth_perc$TN095_105 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN105_107 <- percent(datalog_byMonth_perc$TN105_107 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN107_109 <- percent(datalog_byMonth_perc$TN107_109 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN109_113 <- percent(datalog_byMonth_perc$TN109_113 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN113 <- percent(datalog_byMonth_perc$TN113 / datalog_byMonth_perc$cantidad)
wb2 <-createWorkbook(type="xlsx")
sheet2 <-createSheet(wb2, sheetName = "ABC")
addDataFrame(datalog_byMonth_perc, sheet2, col.names=TRUE, row.names=F,
startRow=1, startColumn=1)
saveWorkbook(wb2, "CoopeGuanacaste2.xlsx")
dataLog2 <- read_feather("featherFiles/dataLog2_3months.feather")
quantity <- read_feather("featherFiles/quantity.feather")
sources <- read_feather("featherFiles/sources.feather")
#quantity$Name <- c('Vab', 'Vbc', 'Vca')
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(RODBC)
library(lubridate)
library(feather)
library(ggplot2)
library(tidyr)
library(xlsx)
# mes anho y numero de meses del reporte
year <- 2020
month <- 2
numberOfMonths <- 1
# tension nomimal
tn <- 24900
limit087 <- 0.87*tn
limit091 <- 0.91*tn
limit093 <- 0.93*tn
limit095 <- 0.95*tn
limit105 <- 1.05*tn
limit107 <- 1.07*tn
limit109 <- 1.09*tn
limit113 <- 1.13*tn
lockBinding(c("tn", "limit087", "limit091", "limit093", "limit095", "limit105", "limit107", "limit109", "limit113"), globalenv())
dataLog2 <- dataLog2 %>% filter(month == 2)
dataLog <- dataLog2 %>% left_join(quantity, by = c('QuantityID' = "ID")) %>%
left_join(sources, by = c('SourceID' = "ID"))
rm(dataLog2)
names(dataLog)[names(dataLog) == "Name.x"] <- "Quantity"
names(dataLog)[names(dataLog) == "Name.y"] <- "Meter"
dataLog$SourceID <- NULL
dataLog$QuantityID <- NULL
dataLog$DisplayName <- NULL
dataLog$TN087 <- if_else(dataLog$Value <= limit087, TRUE, FALSE)
dataLog$TN087_091 <- if_else((dataLog$Value > limit087) & (dataLog$Value <= limit091), TRUE, FALSE)
dataLog$TN091_093 <- if_else((dataLog$Value > limit091) & (dataLog$Value <= limit093), TRUE, FALSE)
dataLog$TN093_095 <- if_else((dataLog$Value > limit093) & (dataLog$Value <= limit095), TRUE, FALSE)
dataLog$TN095_105 <- if_else((dataLog$Value > limit095) & (dataLog$Value <= limit105), TRUE, FALSE)
dataLog$TN105_107 <- if_else((dataLog$Value > limit105) & (dataLog$Value <= limit107), TRUE, FALSE)
dataLog$TN107_109 <- if_else((dataLog$Value > limit107) & (dataLog$Value <= limit109), TRUE, FALSE)
dataLog$TN109_113 <- if_else((dataLog$Value > limit109) & (dataLog$Value <= limit113), TRUE, FALSE)
dataLog$TN113 <- if_else(dataLog$Value > limit113, TRUE, FALSE)
datalog_byMonth <- dataLog %>%
group_by(year, month, Meter, Quantity) %>%
summarise(cantidad = n(),
TN087 = sum(TN087),
TN087_091 = sum(TN087_091),
TN091_093 = sum(TN091_093),
TN093_095 = sum(TN093_095),
TN095_105 = sum(TN095_105),
TN105_107 = sum(TN105_107),
TN107_109 = sum(TN107_109),
TN109_113 = sum(TN109_113),
TN113 = sum(TN113))
percent <- function(x, digits = 2, format = "f", ...) {
paste0(formatC(100 * x, format = format, digits = digits, ...), "%")
}
datalog_byMonth_perc <- datalog_byMonth %>%
group_by(year, month, Meter) %>%
summarise(cantidad = mean(cantidad),
TN087 = mean(TN087),
TN087_091 = mean(TN087_091),
TN091_093 = mean(TN091_093),
TN093_095 = mean(TN093_095),
TN095_105 = mean(TN095_105),
TN105_107 = mean(TN105_107),
TN107_109 = mean(TN107_109),
TN109_113 = mean(TN109_113),
TN113 = mean(TN113))
datalog_byMonth_perc$TN087 <- percent(datalog_byMonth_perc$TN087 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN087_091 <- percent(datalog_byMonth_perc$TN087_091 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN091_093 <- percent(datalog_byMonth_perc$TN091_093 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN093_095 <- percent(datalog_byMonth_perc$TN093_095 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN095_105 <- percent(datalog_byMonth_perc$TN095_105 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN105_107 <- percent(datalog_byMonth_perc$TN105_107 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN107_109 <- percent(datalog_byMonth_perc$TN107_109 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN109_113 <- percent(datalog_byMonth_perc$TN109_113 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN113 <- percent(datalog_byMonth_perc$TN113 / datalog_byMonth_perc$cantidad)
wb2 <-createWorkbook(type="xlsx")
sheet2 <-createSheet(wb2, sheetName = "ABC")
addDataFrame(datalog_byMonth_perc, sheet2, col.names=TRUE, row.names=F,
startRow=1, startColumn=1)
saveWorkbook(wb2, "CoopeGuanacaste2.xlsx")
percent <- function(x, digits = 2, format = "f", ...) {
paste0(formatC(100 * x, format = format, digits = digits, ...), "%")
}
datalog_byMonth_perc <- datalog_byMonth %>%
group_by(year, month, Meter) %>%
summarise(cantidad = mean(cantidad),
TN087 = mean(TN087),
TN087_091 = mean(TN087_091),
TN091_093 = mean(TN091_093),
TN093_095 = mean(TN093_095),
TN095_105 = mean(TN095_105),
TN105_107 = mean(TN105_107),
TN107_109 = mean(TN107_109),
TN109_113 = mean(TN109_113),
TN113 = mean(TN113))
datalog_byMonth_perc$TN087 <- percent(datalog_byMonth_perc$TN087 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN087_091 <- percent(datalog_byMonth_perc$TN087_091 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN091_093 <- percent(datalog_byMonth_perc$TN091_093 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN093_095 <- percent(datalog_byMonth_perc$TN093_095 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN095_105 <- percent(datalog_byMonth_perc$TN095_105 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN105_107 <- percent(datalog_byMonth_perc$TN105_107 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN107_109 <- percent(datalog_byMonth_perc$TN107_109 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN109_113 <- percent(datalog_byMonth_perc$TN109_113 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN113 <- percent(datalog_byMonth_perc$TN113 / datalog_byMonth_perc$cantidad)
wb2 <-createWorkbook(type="xlsx")
sheet2 <-createSheet(wb2, sheetName = "ABC")
addDataFrame(datalog_byMonth_perc, sheet2, col.names=TRUE, row.names=F,
startRow=1, startColumn=1)
saveWorkbook(wb2, "CoopeGuanacaste2.xlsx")
percent <- function(x, digits = 2, format = "f", ...) {
paste0(formatC(100 * x, format = format, digits = digits, ...), "%")
}
datalog_byMonth_perc <- datalog_byMonth %>%
group_by(year, month, Meter) %>%
summarise(cantidad = mean(cantidad),
TN087 = mean(TN087),
TN087_091 = mean(TN087_091),
TN091_093 = mean(TN091_093),
TN093_095 = mean(TN093_095),
TN095_105 = mean(TN095_105),
TN105_107 = mean(TN105_107),
TN107_109 = mean(TN107_109),
TN109_113 = mean(TN109_113),
TN113 = mean(TN113))
datalog_byMonth_perc$TN087 <- percent(datalog_byMonth_perc$TN087 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN087_091 <- percent(datalog_byMonth_perc$TN087_091 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN091_093 <- percent(datalog_byMonth_perc$TN091_093 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN093_095 <- percent(datalog_byMonth_perc$TN093_095 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN095_105 <- percent(datalog_byMonth_perc$TN095_105 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN105_107 <- percent(datalog_byMonth_perc$TN105_107 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN107_109 <- percent(datalog_byMonth_perc$TN107_109 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN109_113 <- percent(datalog_byMonth_perc$TN109_113 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN113 <- percent(datalog_byMonth_perc$TN113 / datalog_byMonth_perc$cantidad)
wb2 <-createWorkbook(type="xlsx")
sheet2 <-createSheet(wb2, sheetName = "ABC")
addDataFrame(datalog_byMonth_perc, sheet2, col.names=TRUE, row.names=F,
startRow=1, startColumn=1, byrow = T)
saveWorkbook(wb2, "CoopeGuanacaste2.xlsx")
percent <- function(x, digits = 2, format = "f", ...) {
paste0(formatC(100 * x, format = format, digits = digits, ...), "%")
}
datalog_byMonth_perc <- datalog_byMonth %>%
group_by(year, month, Meter) %>%
summarise(cantidad = mean(cantidad),
TN087 = mean(TN087),
TN087_091 = mean(TN087_091),
TN091_093 = mean(TN091_093),
TN093_095 = mean(TN093_095),
TN095_105 = mean(TN095_105),
TN105_107 = mean(TN105_107),
TN107_109 = mean(TN107_109),
TN109_113 = mean(TN109_113),
TN113 = mean(TN113))
wb2 <-createWorkbook(type="xlsx")
sheet2 <-createSheet(wb2, sheetName = "ABC")
addDataFrame(datalog_byMonth_perc, sheet2, col.names=TRUE, row.names=F,
startRow=1, startColumn=1)
saveWorkbook(wb2, "CoopeGuanacaste2.xlsx")
percent <- function(x, digits = 2, format = "f", ...) {
paste0(formatC(100 * x, format = format, digits = digits, ...), "%")
}
datalog_byMonth_perc <- datalog_byMonth %>%
group_by(year, month, Meter) %>%
summarise(cantidad = mean(cantidad),
TN087 = mean(TN087),
TN087_091 = mean(TN087_091),
TN091_093 = mean(TN091_093),
TN093_095 = mean(TN093_095),
TN095_105 = mean(TN095_105),
TN105_107 = mean(TN105_107),
TN107_109 = mean(TN107_109),
TN109_113 = mean(TN109_113),
TN113 = mean(TN113))
wb2 <-createWorkbook(type="xlsx")
sheet2 <-createSheet(wb2, sheetName = "ABC")
addDataFrame(datalog_byMonth_perc, sheet2, col.names=TRUE, row.names=F,
startRow=1, startColumn=1)
saveWorkbook(wb2, "CoopeGuanacaste2.xlsx")
percent <- function(x, digits = 2, format = "f", ...) {
paste0(formatC(100 * x, format = format, digits = digits, ...), "%")
}
datalog_byMonth_perc <- datalog_byMonth %>%
group_by(year, month, Meter) %>%
summarise(cantidad = mean(cantidad),
TN087 = mean(TN087),
TN087_091 = mean(TN087_091),
TN091_093 = mean(TN091_093),
TN093_095 = mean(TN093_095),
TN095_105 = mean(TN095_105),
TN105_107 = mean(TN105_107),
TN107_109 = mean(TN107_109),
TN109_113 = mean(TN109_113),
TN113 = mean(TN113))
wb2 <-createWorkbook(type="xlsx")
sheet2 <-createSheet(wb2, sheetName = "ABC")
addDataFrame(datalog_byMonth_perc, sheet2, col.names=TRUE, row.names=F,
startRow=1, startColumn=1)
saveWorkbook(wb2, "CoopeGuanacaste2.xlsx")
percent <- function(x, digits = 2, format = "f", ...) {
paste0(formatC(100 * x, format = format, digits = digits, ...), "%")
}
datalog_byMonth_perc <- datalog_byMonth %>%
group_by(year, month, Meter) %>%
summarise(cantidad = mean(cantidad),
TN087 = mean(TN087),
TN087_091 = mean(TN087_091),
TN091_093 = mean(TN091_093),
TN093_095 = mean(TN093_095),
TN095_105 = mean(TN095_105),
TN105_107 = mean(TN105_107),
TN107_109 = mean(TN107_109),
TN109_113 = mean(TN109_113),
TN113 = mean(TN113))
wb2 <-createWorkbook(type="xlsx")
sheet2 <-createSheet(wb2, sheetName = "ABC")
addDataFrame(as.data.frame(datalog_byMonth_perc), sheet2, col.names=TRUE, row.names=F,
startRow=1, startColumn=1)
saveWorkbook(wb2, "CoopeGuanacaste2.xlsx")
percent <- function(x, digits = 2, format = "f", ...) {
paste0(formatC(100 * x, format = format, digits = digits, ...), "%")
}
datalog_byMonth_perc <- datalog_byMonth %>%
group_by(year, month, Meter) %>%
summarise(cantidad = mean(cantidad),
TN087 = mean(TN087),
TN087_091 = mean(TN087_091),
TN091_093 = mean(TN091_093),
TN093_095 = mean(TN093_095),
TN095_105 = mean(TN095_105),
TN105_107 = mean(TN105_107),
TN107_109 = mean(TN107_109),
TN109_113 = mean(TN109_113),
TN113 = mean(TN113))
wb2 <-createWorkbook(type="xlsx")
sheet2 <-createSheet(wb2, sheetName = "ABC")
setColumnWidth(sheet2, colIndex=3, colWidth=20)
addDataFrame(as.data.frame(datalog_byMonth_perc), sheet2, col.names=TRUE, row.names=F,
startRow=1, startColumn=1)
saveWorkbook(wb2, "CoopeGuanacaste2.xlsx")
percent <- function(x, digits = 2, format = "f", ...) {
paste0(formatC(100 * x, format = format, digits = digits, ...), "%")
}
datalog_byMonth_perc <- datalog_byMonth %>%
group_by(year, month, Meter) %>%
summarise(cantidad = mean(cantidad),
TN087 = mean(TN087),
TN087_091 = mean(TN087_091),
TN091_093 = mean(TN091_093),
TN093_095 = mean(TN093_095),
TN095_105 = mean(TN095_105),
TN105_107 = mean(TN105_107),
TN107_109 = mean(TN107_109),
TN109_113 = mean(TN109_113),
TN113 = mean(TN113))
wb2 <-createWorkbook(type="xlsx")
sheet2 <-createSheet(wb2, sheetName = "ABC")
setColumnWidth(sheet2, colIndex=3, colWidth=30)
addDataFrame(as.data.frame(datalog_byMonth_perc), sheet2, col.names=TRUE, row.names=F,
startRow=1, startColumn=1)
saveWorkbook(wb2, "CoopeGuanacaste2.xlsx")
percent <- function(x, digits = 2, format = "f", ...) {
paste0(formatC(100 * x, format = format, digits = digits, ...), "%")
}
datalog_byMonth_perc <- datalog_byMonth %>%
group_by(year, month, Meter) %>%
summarise(cantidad = mean(cantidad),
TN087 = mean(TN087),
TN087_091 = mean(TN087_091),
TN091_093 = mean(TN091_093),
TN093_095 = mean(TN093_095),
TN095_105 = mean(TN095_105),
TN105_107 = mean(TN105_107),
TN107_109 = mean(TN107_109),
TN109_113 = mean(TN109_113),
TN113 = mean(TN113))
datalog_byMonth_perc$TN087 <- percent(datalog_byMonth_perc$TN087 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN087_091 <- percent(datalog_byMonth_perc$TN087_091 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN091_093 <- percent(datalog_byMonth_perc$TN091_093 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN093_095 <- percent(datalog_byMonth_perc$TN093_095 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN095_105 <- percent(datalog_byMonth_perc$TN095_105 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN105_107 <- percent(datalog_byMonth_perc$TN105_107 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN107_109 <- percent(datalog_byMonth_perc$TN107_109 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN109_113 <- percent(datalog_byMonth_perc$TN109_113 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN113 <- percent(datalog_byMonth_perc$TN113 / datalog_byMonth_perc$cantidad)
wb2 <-createWorkbook(type="xlsx")
sheet2 <-createSheet(wb2, sheetName = "ABC")
setColumnWidth(sheet2, colIndex=3, colWidth=30)
addDataFrame(as.data.frame(datalog_byMonth_perc), sheet2, col.names=TRUE, row.names=F,
startRow=1, startColumn=1)
saveWorkbook(wb2, "CoopeGuanacaste2.xlsx")
percent <- function(x, digits = 2, format = "f", ...) {
paste0(formatC(100 * x, format = format, digits = digits, ...), "%")
}
datalog_byMonth_perc <- datalog_byMonth %>%
group_by(year, month, Meter) %>%
summarise(cantidad = mean(cantidad),
TN087 = mean(TN087),
TN087_091 = mean(TN087_091),
TN091_093 = mean(TN091_093),
TN093_095 = mean(TN093_095),
TN095_105 = mean(TN095_105),
TN105_107 = mean(TN105_107),
TN107_109 = mean(TN107_109),
TN109_113 = mean(TN109_113),
TN113 = mean(TN113))
datalog_byMonth_perc$TN087 <- percent(datalog_byMonth_perc$TN087 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN087_091 <- percent(datalog_byMonth_perc$TN087_091 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN091_093 <- percent(datalog_byMonth_perc$TN091_093 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN093_095 <- percent(datalog_byMonth_perc$TN093_095 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN095_105 <- percent(datalog_byMonth_perc$TN095_105 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN105_107 <- percent(datalog_byMonth_perc$TN105_107 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN107_109 <- percent(datalog_byMonth_perc$TN107_109 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN109_113 <- percent(datalog_byMonth_perc$TN109_113 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN113 <- percent(datalog_byMonth_perc$TN113 / datalog_byMonth_perc$cantidad)
wb2 <-createWorkbook(type="xlsx")
sheet2 <-createSheet(wb2, sheetName = "ABC")
setColumnWidth(sheet2, colIndex=3, colWidth=30)
TITLE_STYLE <- CellStyle(wb2)+ Font(wb2,  heightInPoints=10,
isBold=TRUE, name="Arial") + Alignment(horizontal="ALIGN_CENTER")
addDataFrame(as.data.frame(datalog_byMonth_perc), sheet2, col.names=TRUE, row.names=F,
startRow=1, startColumn=1, rownamesStyle=TITLE_STYLE)
saveWorkbook(wb2, "CoopeGuanacaste2.xlsx")
percent <- function(x, digits = 2, format = "f", ...) {
paste0(formatC(100 * x, format = format, digits = digits, ...), "%")
}
datalog_byMonth_perc <- datalog_byMonth %>%
group_by(year, month, Meter) %>%
summarise(cantidad = mean(cantidad),
TN087 = mean(TN087),
TN087_091 = mean(TN087_091),
TN091_093 = mean(TN091_093),
TN093_095 = mean(TN093_095),
TN095_105 = mean(TN095_105),
TN105_107 = mean(TN105_107),
TN107_109 = mean(TN107_109),
TN109_113 = mean(TN109_113),
TN113 = mean(TN113))
datalog_byMonth_perc$TN087 <- percent(datalog_byMonth_perc$TN087 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN087_091 <- percent(datalog_byMonth_perc$TN087_091 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN091_093 <- percent(datalog_byMonth_perc$TN091_093 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN093_095 <- percent(datalog_byMonth_perc$TN093_095 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN095_105 <- percent(datalog_byMonth_perc$TN095_105 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN105_107 <- percent(datalog_byMonth_perc$TN105_107 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN107_109 <- percent(datalog_byMonth_perc$TN107_109 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN109_113 <- percent(datalog_byMonth_perc$TN109_113 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN113 <- percent(datalog_byMonth_perc$TN113 / datalog_byMonth_perc$cantidad)
wb2 <-createWorkbook(type="xlsx")
sheet2 <-createSheet(wb2, sheetName = "ABC")
setColumnWidth(sheet2, colIndex=3, colWidth=30)
TITLE_STYLE <- CellStyle(wb2)+ Font(wb2,  heightInPoints=10,
isBold=TRUE, name="Arial") + Alignment(horizontal="ALIGN_CENTER")
#addDataFrame(as.data.frame(datalog_byMonth_perc), sheet2, col.names=TRUE, row.names=F,
#              startRow=1, startColumn=1, rownamesStyle=TITLE_STYLE)
saveWorkbook(wb2, "CoopeGuanacaste2.xlsx")
percent <- function(x, digits = 2, format = "f", ...) {
paste0(formatC(100 * x, format = format, digits = digits, ...), "%")
}
datalog_byMonth_perc <- datalog_byMonth %>%
group_by(year, month, Meter) %>%
summarise(cantidad = mean(cantidad),
TN087 = mean(TN087),
TN087_091 = mean(TN087_091),
TN091_093 = mean(TN091_093),
TN093_095 = mean(TN093_095),
TN095_105 = mean(TN095_105),
TN105_107 = mean(TN105_107),
TN107_109 = mean(TN107_109),
TN109_113 = mean(TN109_113),
TN113 = mean(TN113))
datalog_byMonth_perc$TN087 <- percent(datalog_byMonth_perc$TN087 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN087_091 <- percent(datalog_byMonth_perc$TN087_091 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN091_093 <- percent(datalog_byMonth_perc$TN091_093 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN093_095 <- percent(datalog_byMonth_perc$TN093_095 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN095_105 <- percent(datalog_byMonth_perc$TN095_105 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN105_107 <- percent(datalog_byMonth_perc$TN105_107 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN107_109 <- percent(datalog_byMonth_perc$TN107_109 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN109_113 <- percent(datalog_byMonth_perc$TN109_113 / datalog_byMonth_perc$cantidad)
datalog_byMonth_perc$TN113 <- percent(datalog_byMonth_perc$TN113 / datalog_byMonth_perc$cantidad)
wb2 <-createWorkbook(type="xlsx")
sheet2 <-createSheet(wb2, sheetName = "ABC")
setColumnWidth(sheet2, colIndex=3, colWidth=30)
TITLE_STYLE <- CellStyle(wb2)+ Font(wb2,  heightInPoints=50,
isBold=TRUE, name="Arial") + Alignment(horizontal="ALIGN_CENTER")
addDataFrame(as.data.frame(datalog_byMonth_perc), sheet2, col.names=TRUE, row.names=F,
startRow=1, startColumn=1, rownamesStyle=TITLE_STYLE)
saveWorkbook(wb2, "CoopeGuanacaste2.xlsx")
wb2 <-createWorkbook(type="xlsx")
sheet2 <-createSheet(wb2, sheetName = "ABC")
setColumnWidth(sheet2, colIndex=3, colWidth=30)
TABLE_ROWNAMES_STYLE <- CellStyle(wb2) + Font(wb2, isBold=TRUE)
TABLE_COLNAMES_STYLE <- CellStyle(wb2) + Font(wb2, isBold=TRUE) +
Alignment(wrapText=TRUE, horizontal="ALIGN_CENTER") +
Border(color="black", position=c("TOP", "BOTTOM"),
pen=c("BORDER_THIN", "BORDER_THICK"))
# Add a table
addDataFrame(state.x77, sheet2, startRow=20, startColumn=1,
colnamesStyle = TABLE_COLNAMES_STYLE,
rownamesStyle = TABLE_ROWNAMES_STYLE)
# Change column width
setColumnWidth(sheet, colIndex=c(1:ncol(state.x77)), colWidth=11)
wb2 <-createWorkbook(type="xlsx")
sheet2 <-createSheet(wb2, sheetName = "ABC")
setColumnWidth(sheet2, colIndex=3, colWidth=30)
TABLE_ROWNAMES_STYLE <- CellStyle(wb2) + Font(wb2, isBold=TRUE)
TABLE_COLNAMES_STYLE <- CellStyle(wb2) + Font(wb2, isBold=TRUE) +
Alignment(wrapText=TRUE, horizontal="ALIGN_CENTER") +
Border(color="black", position=c("TOP", "BOTTOM"),
pen=c("BORDER_THIN", "BORDER_THICK"))
# Add a table
addDataFrame(state.x77, sheet2, startRow=20, startColumn=1,
colnamesStyle = TABLE_COLNAMES_STYLE,
rownamesStyle = TABLE_ROWNAMES_STYLE)
# Change column width
setColumnWidth(sheet2, colIndex=c(1:ncol(state.x77)), colWidth=11)
saveWorkbook(wb2, "CoopeGuanacaste2.xlsx")
startRow=1, startColumn=1, rownamesStyle=TITLE_STYLE)
wb2 <-createWorkbook(type="xlsx")
sheet2 <-createSheet(wb2, sheetName = "ABC")
setColumnWidth(sheet2, colIndex=3, colWidth=30)
TABLE_ROWNAMES_STYLE <- CellStyle(wb2) + Font(wb2, isBold=TRUE)
TABLE_COLNAMES_STYLE <- CellStyle(wb2) + Font(wb2, isBold=TRUE) +
Alignment(wrapText=TRUE, horizontal="ALIGN_CENTER") +
Border(color="black", position=c("TOP", "BOTTOM"),
pen=c("BORDER_THIN", "BORDER_THICK"))
TABLE_STYLE <- CellStyle(wb2) +
Alignment(wrapText=TRUE, horizontal="ALIGN_CENTER")
# Add a table
addDataFrame(state.x77, sheet2, startRow=20, startColumn=1,
colnamesStyle = TABLE_COLNAMES_STYLE,
rownamesStyle = TABLE_ROWNAMES_STYLE, colStyle = TABLE_STYLE)
# Change column width
setColumnWidth(sheet2, colIndex=c(1:ncol(state.x77)), colWidth=11)
saveWorkbook(wb2, "CoopeGuanacaste2.xlsx")
install.packages("openxls")
install.packages("openxlsx")
library(openxlsx)
library(openxlsx)
## write to working directory
write.xlsx(iris, file = "writeXLSX1.xlsx")
write.xlsx(iris, file = "writeXLSXTable1.xlsx", asTable = TRUE)
## write a list of data.frames to individual worksheets using list names as worksheet names
l <- list("IRIS" = iris, "MTCARS" = mtcars)
write.xlsx(l, file = "writeXLSX2.xlsx")
write.xlsx(l, file = "writeXLSXTable2.xlsx", asTable = TRUE)
write.xlsx(df, file = "writeXLSXTable3.xlsx", asTable = TRUE)
library(openxlsx)
## write.xlsx also accepts styling parameters.
## The simplest way is to set default options and set column class
options("openxlsx.borderColour" = "#4F80BD")
options("openxlsx.borderStyle" = "thin")
options("openxlsx.dateFormat" = "mm/dd/yyyy")
options("openxlsx.datetimeFormat" = "yyyy-mm-dd hh:mm:ss")
options("openxlsx.numFmt" = NULL) ## For default style rounding of numeric columns
df <- data.frame("Date" = Sys.Date()-0:19, "LogicalT" = TRUE,
"Time" = Sys.time()-0:19*60*60,
"Cash" = paste("$",1:20), "Cash2" = 31:50,
"hLink" = "https://CRAN.R-project.org/",
"Percentage" = seq(0, 1, length.out=20),
"TinyNumbers" = runif(20) / 1E9, stringsAsFactors = FALSE)
class(df$Cash) <- "currency"
class(df$Cash2) <- "accounting"
class(df$hLink) <- "hyperlink"
class(df$Percentage) <- "percentage"
class(df$TinyNumbers) <- "scientific"
write.xlsx(df, "writeXLSX3.xlsx")
write.xlsx(df, file = "writeXLSXTable3.xlsx", asTable = TRUE)
library(openxlsx)
## Additional styling
## define a style for column headers
hs <- createStyle(fontColour = "#ffffff", fgFill = "#4F80BD",
halign = "center", valign = "center", textDecoration = "Bold",
border = "TopBottomLeftRight", textRotation = 45)
write.xlsx(iris, file = "writeXLSX4.xlsx", borders = "rows", headerStyle = hs)
write.xlsx(iris, file = "writeXLSX5.xlsx", borders = "columns", headerStyle = hs)
library(openxlsx)
## Additional styling
## define a style for column headers
hs <- createStyle(fontColour = "#ffffff", fgFill = "#4F80BD",
halign = "center", valign = "center", textDecoration = "Bold",
border = "TopBottomLeftRight", textRotation = 75)
write.xlsx(iris, file = "writeXLSX4.xlsx", borders = "rows", headerStyle = hs)
write.xlsx(iris, file = "writeXLSX5.xlsx", borders = "columns", headerStyle = hs)
library(openxlsx)
## When writing a list, the stylings will apply to all list elements
l <- list("IRIS" = iris, "colClasses" = df)
write.xlsx(l, file = "writeXLSX6.xlsx", borders = "columns", headerStyle = hs)
write.xlsx(l, file = "writeXLSXTable5.xlsx", asTable = TRUE, tableStyle = "TableStyleLight2")
glimpse(df)
library(dplyr)
glimpse(df)
View(df)
